<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>ğŸ“º ä¿¾æ¡è•‰ä½ é£Ÿâ€¦</title>
    <style>
        :root {
            --primary-color: #4F46E5;
            --secondary-color: #818CF8;
            --background-color: #F3F4F6;
            --card-color: #FFFFFF;
            --text-color: #1F2937;
            --hover-color: #6366F1;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background-color: var(--background-color);
            min-height: 100vh;
            padding: 2rem 1rem;
            color: var(--text-color);
            transition: opacity 0.3s ease;
        }
        
        h2 {
          text-align: center;
        }

        .language-selector {
            position: fixed;
            top: 1rem;
            right: 1rem;
            z-index: 1001;
            background-color: var(--card-color);
            border-radius: 0.5rem;
            padding: 0.5rem;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            border: 1px solid #E5E7EB;
        }

        .language-selector select {
            border: none;
            background: transparent;
            font-size: 0.875rem;
            color: var(--text-color);
            cursor: pointer;
            outline: none;
            padding: 0.25rem;
        }

        .translating-indicator {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 1rem 2rem;
            border-radius: 0.5rem;
            display: none;
            z-index: 2000;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 2rem;
            background-color: var(--card-color);
            border-radius: 1rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        .title {
            font-size: 2rem;
            font-weight: 700;
            text-align: center;
            margin-bottom: 1.5rem;
            color: var(--primary-color);
            letter-spacing: -0.025em;
        }

        .subtitle {
            text-align: center;
            color: #6B7280;
            margin-bottom: 2rem;
            font-size: 0.875rem;
        }

        .subscription-grid {
            display: grid;
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .subscription-link {
            background-color: var(--card-color);
            padding: 1rem;
            border-radius: 0.75rem;
            cursor: pointer;
            transition: all 0.2s ease;
            border: 2px solid #E5E7EB;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 500;
            font-size: 1.125rem;
        }

        .subscription-link:hover {
            border-color: var(--primary-color);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(79, 70, 229, 0.1);
        }

        .subscription-link .emoji {
            margin-right: 0.5rem;
            font-size: 1.25rem;
        }

        .small-links {
            display: flex;
            justify-content: center;
            gap: 1.5rem;
            margin-top: 2rem;
            padding-top: 1rem;
            border-top: 1px solid #E5E7EB;
            flex-wrap: wrap;
        }

        .small-links a {
            text-decoration: none;
            color: #6B7280;
            font-size: 0.875rem;
            transition: color 0.2s ease;
        }

        .small-links a:hover {
            color: var(--primary-color);
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
        }

        .modal-content {
            background-color: var(--card-color);
            margin: 2rem auto;
            padding: 2rem;
            border-radius: 1rem;
            width: 90%;
            max-width: 600px;
            max-height: 85vh;
            position: relative;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
        }

        .update-content {
            overflow-y: auto;
            padding-right: 1rem;
            margin-right: -1rem;
            scrollbar-width: thin;
            scrollbar-color: #CBD5E1 transparent;
        }

        .update-content::-webkit-scrollbar {
            width: 6px;
        }

        .update-content::-webkit-scrollbar-track {
            background: transparent;
        }

        .update-content::-webkit-scrollbar-thumb {
            background-color: #CBD5E1;
            border-radius: 3px;
        }

        .update-content::-webkit-scrollbar-thumb:hover {
            background-color: #94A3B8;
        }

        .close-btn {
            position: absolute;
            right: 1.5rem;
            top: 1.5rem;
            font-size: 1.5rem;
            cursor: pointer;
            color: #6B7280;
            transition: color 0.2s ease;
            z-index: 1;
        }

        .close-btn:hover {
            color: var(--text-color);
        }

        .update-content h2 {
            font-size: 1.5rem;
            margin-bottom: 1rem;
            color: var(--primary-color);
            position: sticky;
            top: 0;
            background-color: var(--card-color);
            padding: 0.5rem 0;
        }

        .update-section {
            border-left: 2px solid #E5E7EB;
            padding-left: 1rem;
            margin-bottom: 1.5rem;
        }

        .update-date {
            font-weight: 600;
            color: var(--primary-color);
            margin-bottom: 0.5rem;
        }

        .update-item {
            margin-bottom: 0.5rem;
            padding-left: 1rem;
            position: relative;
        }

        .update-item::before {
            content: "â—¦";
            position: absolute;
            left: 0;
            color: #6B7280;
        }

        .notice-text {
            color: #EF4444;
            font-weight: 500;
            text-align: center;
            margin-bottom: 1rem;
            padding: 0.5rem;
            border: 1px solid #FCA5A5;
            border-radius: 0.5rem;
            background-color: #FEF2F2;
        }

        @media (min-width: 640px) {
            .subscription-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 640px) {
            .small-links {
                gap: 1rem;
            }
            .language-selector {
                position: static;
                margin-bottom: 1rem;
                text-align: center;
            }
        }

        /* ç¿»è¯‘çŠ¶æ€æŒ‡ç¤º */
        .translating {
            opacity: 0.7;
            pointer-events: none;
        }
    </style>
</head>
<body>
    <div class="language-selector">
        <select id="languageSelect" onchange="changeLanguage(this.value)">
            <option value="zh-CN">ğŸ‡¨ğŸ‡³ ç®€ä½“ä¸­æ–‡</option>
            <option value="zh-TW">ğŸ‡­ğŸ‡° ç¹é«”ä¸­æ–‡</option>
            <option value="en">ğŸ‡ºğŸ‡¸ English</option>
            <option value="ja">ğŸ‡¯ğŸ‡µ æ—¥æœ¬èª</option>
            <option value="ko">ğŸ‡°ğŸ‡· í•œêµ­ì–´</option>
            <option value="es">ğŸ‡ªğŸ‡¸ EspaÃ±ol</option>
            <option value="fr">ğŸ‡«ğŸ‡· FranÃ§ais</option>
            <option value="de">ğŸ‡©ğŸ‡ª Deutsch</option>
            <option value="ru">ğŸ‡·ğŸ‡º Ğ ÑƒÑÑĞºĞ¸Ğ¹</option>
            <option value="ar">ğŸ‡¸ğŸ‡¦ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</option>
        </select>
    </div>

    <div class="translating-indicator" id="translatingIndicator">
        æ­£åœ¨ç¿»è¯‘ä¸­... / Translating...
    </div>

    <div class="container">
        <h1 class="title">ä½›ç³»æ”¶é›†ï¼Œå…è´¹åˆ†äº« ğŸ˜Š</h1>
        <p class="subtitle">å®æ—¶ç›´æ’­é›†èƒ ğŸŒŸ| å°½äº«ç²¾å½©ç¬é—´</p>
        
        <div class="subscription-grid">
            <div class="subscription-link" onclick="copySubscriptionLink('https://tv.iill.top/m3u/Gather')">
                <span class="emoji">ğŸ“º</span>ç”µè§† ç›´æ’­
            </div>

            <div class="subscription-link" onclick="copySubscriptionLink('https://m.iill.top/Live.m3u')">
                <span class="emoji">ğŸ¥</span>ç½‘ç»œ ç›´æ’­
            </div>

            <div class="subscription-link" onclick="copyMytvLink()">
                <span class="emoji">ğŸ“¡</span>myTV ç›´æ’­
            </div>

            <div class="subscription-link" onclick="copySportLink()">
                <span class="emoji">ğŸš´â€â™‚ï¸</span>ä½“è‚² ç›´æ’­
            </div>

            <div class="subscription-link" onclick="copyYsLink()">
                <span class="emoji">ğŸï¸</span>å½±è§† Json
            </div>

            <div class="subscription-link" onclick="copyShellLink()">
                <span class="emoji">ğŸ’»</span>Shell è„šæœ¬
            </div>
        </div>

        <div class="small-links">
            <a href="https://github.com/YanG-1989" target="_blank">GitHub</a>
            <a href="https://t.me/Y_anGGGGGG" target="_blank">Telegram</a>
            <a href="https://epg.iill.top" target="_blank">EPG Viewer</a>
            <a href="https://yang-1989.eu.org/Conversion.php" target="_blank">æ ¼å¼è½¬æ¢</a>
            <a href="https://m.iill.top" target="_blank">ç›´æ’­å½•å…¥</a>
            <a href="http://i.iill.top:13043" target="_blank">å½±è§†æœç´¢</a>
        </div>
    </div>

    <div id="updateModal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="closeUpdateNotice()">&times;</span>
            <div class="update-content">
                <h2 style="text-align: center;">âœ¨ å…¬å‘Š âœ¨</h2>
                <div class="notice-text">è¯·å‹¿é¢‘ç¹åˆ·æ–°è®¢é˜…..</div>
                
                <strong>ãŠ€ Â· æ›´æ–°æ—¥å¿— ğŸ“</strong>
                <div class="update-section">
                    <div class="update-date">â€¢ 2025.9.30</div>
                    <div class="update-item">è¯¦ç»† å…¬å‘Šã€ŒTGé¢‘é“ æŸ¥é˜…ã€</div>

                    <div class="update-date">â€¢ 2025.9.14</div>
                    <div class="update-item">ç»´æŠ¤ Liveã€Œæ›´æ”¹è®¢é˜…åœ°å€ / å–æ¶ˆ YouTube é™åˆ¶ã€</div>

                    <div class="update-date">â€¢ 2025.9.12</div>
                    <div class="update-item">æµ‹è¯• å’ªå’•ç³»åˆ—ã€Œåˆ é™¤ tv-1 å­åŸŸåã€</div>

                    <div class="update-date">â€¢ 2025.9.1</div>
                    <div class="update-item">è¿‘æœŸ ç»´æŠ¤æ€»ç»“ã€ŒTGé¢‘é“ æŸ¥é˜…ã€</div>

                    <div class="update-date">â€¢ 2025.8.20</div>
                    <div class="update-item">ç»´æŠ¤ Gatherã€Œæ–°å¢ â€¢å’ªå’•ã€Œæµ·å¤–ã€/ ä¼˜åŒ– "å¹¿å‘Š"ã€</div>

                    <div class="update-date">â€¢ 2025.8.9</div>
                    <div class="update-item">ç»´æŠ¤ Gatherã€Œâ€¢å’ªå’•ã€ŒTVã€æ”¯æŒå›çœ‹ã€</div>

                    <div class="update-date">â€¢ 2025.8.8</div>
                    <div class="update-item">ç»´æŠ¤ Gatherã€Œåˆ é™¤ æ—¥/éŸ©åˆ†ç»„ã€</div>
                    <div class="update-item">ç»´æŠ¤ "å¹¿å‘Š"ã€Œå…¼å®¹æ€§ BUGã€</div>

                    <div class="update-date">â€¢ 2025.8.3</div>
                    <div class="update-item">ç»´æŠ¤ Gatherã€Œå¢åŠ  å¤‡ç”¨åœ°å€ã€</div>
                    <div class="update-item">ç»´æŠ¤ Liveã€Œå¢åŠ  å¤‡ç”¨åœ°å€ã€</div>
                    <div class="update-item">ç»´æŠ¤ Sportã€Œå¢åŠ  å¤‡ç”¨åœ°å€ã€</div>
                    <div class="update-item">å¢åŠ  "å¹¿å‘Š"ã€Œæ—¶æ•ˆ 6â€“24 å°æ—¶ã€</div>

                    <div class="update-date">â€¢ 2025.7.24</div>
                    <div class="update-item">ç»´æŠ¤ Sportã€Œä¿®å¤ éƒ¨åˆ†æ’­æ”¾å™¨ å¤±æ•ˆBUG / å…¼å®¹æ›´å¤šæ’­æ”¾å™¨ã€</div>

                    <div class="update-date">â€¢ 2025.7.22</div>
                    <div class="update-item">ç»´æŠ¤ Liveã€Œä¼˜åŒ– YouTube/Twitch ä»£ç†ã€</div>
                    <div class="update-item">ç»´æŠ¤ Gatherã€Œå¢åŠ  ç¿¡ç¿ /ç„¡ç¶«æ–°è-éšæ—¶æ‹‰é—¸ã€</div>

                    <div class="update-date">â€¢ 2025.6.23</div>
                    <div class="update-item">ç»´æŠ¤ Liveã€Œæ–°å¢ æ•…éšœè½¬ç§»æœºåˆ¶ã€</div>
                    <div class="update-item">ç»´æŠ¤ Liveã€Œæ›´æ–° å‘¨æœŸæ”¹ä¸º 20 åˆ†é’Ÿã€</div>

                    <div class="update-date">â€¢ 2025.6.4</div>
                    <div class="update-item">ç»´æŠ¤ Gatherã€Œå¢åŠ  â€¢å’ªå’•ã€ŒTVã€FHD/HD é¢‘é“ã€</div>
                    <div class="update-item">ç»´æŠ¤ Liveã€Œæ›¿æ¢ å›½å†…VPS è§£æã€</div>
                    <div class="update-item">ç»´æŠ¤ Sportã€Œå¢åŠ  ä¸¤ä¸ªé¢‘é“ã€</div>
                    <div class="update-item">ç»´æŠ¤ myTVã€Œæ›¿æ¢ éƒ¨åˆ†é¢‘é“ LOGOã€</div>
                    <div class="update-item">å¢åŠ  <a href="https://yang-1989.eu.org/Conversion.php" target="_blank">æ ¼å¼è½¬æ¢</a> <span>ã€Œå¶å°”å¯èƒ½æœ‰ç”¨ã€</span>

                </div>

                <strong>ãŠ Â· ä½¿ç”¨è¯´æ˜ ğŸ“˜</strong>
                <div class="update-section">
                    <div class="update-item">è¯·åœ¨æ’­æ”¾å™¨ä¸­ä½¿ç”¨..</div>
                    <div class="update-item">ç–‘éš¾æ‚ç—‡,è¯·ç§»æ­¥ Github..</div>
                    <div class="update-item">ç‰¹æ®Šé¢‘é“,è¯·ä¿æŒè®¢é˜…ä¸æ’­æ”¾IPä¸€è‡´..</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentLanguage = 'zh-CN';
        let originalContent = new Map();
        let translationCache = {};
        
        // ç¿»è¯‘ç¼“å­˜ç®¡ç†
        const CACHE_EXPIRATION = 365 * 24 * 60 * 60 * 1000; // 30å¤©ï¼Œè€å†…å®¹åŸºæœ¬ä¸å˜
        const CACHE_VERSION = '1.0'; // ç¼“å­˜ç‰ˆæœ¬ï¼Œæ›´æ–°æ—¶å¯ä»¥æ¸…é™¤æ—§ç¼“å­˜

        // åŠ è½½ç¿»è¯‘ç¼“å­˜
        function loadTranslationCache() {
            try {
                const cachedData = window.localStorage.getItem('translationCache');
                if (cachedData) {
                    const parsedData = JSON.parse(cachedData);
                    
                    // æ£€æŸ¥ç¼“å­˜ç‰ˆæœ¬
                    if (parsedData.version !== CACHE_VERSION) {
                        console.log('ç¼“å­˜ç‰ˆæœ¬ä¸åŒ¹é…ï¼Œæ¸…é™¤æ—§ç¼“å­˜');
                        clearTranslationCache();
                        return;
                    }
                    
                    // æ£€æŸ¥ç¼“å­˜æ˜¯å¦è¿‡æœŸ
                    if (parsedData.timestamp && (Date.now() - parsedData.timestamp < CACHE_EXPIRATION)) {
                        translationCache = parsedData.cache || {};
                        console.log('åŠ è½½ç¿»è¯‘ç¼“å­˜ï¼Œå…±', Object.keys(translationCache).length, 'æ¡è®°å½•');
                    } else {
                        console.log('ç¿»è¯‘ç¼“å­˜å·²è¿‡æœŸï¼Œæ¸…é™¤ç¼“å­˜');
                        clearTranslationCache();
                    }
                }
            } catch (error) {
                console.warn('åŠ è½½ç¿»è¯‘ç¼“å­˜å¤±è´¥:', error);
                clearTranslationCache();
            }
        }

        // ä¿å­˜ç¿»è¯‘ç¼“å­˜
        function saveTranslationCache() {
            try {
                const cacheData = {
                    version: CACHE_VERSION,
                    timestamp: Date.now(),
                    cache: translationCache
                };
                window.localStorage.setItem('translationCache', JSON.stringify(cacheData));
                console.log('ç¿»è¯‘ç¼“å­˜å·²ä¿å­˜ï¼Œå…±', Object.keys(translationCache).length, 'æ¡è®°å½•');
            } catch (error) {
                console.warn('ä¿å­˜ç¿»è¯‘ç¼“å­˜å¤±è´¥:', error);
                // å¦‚æœå­˜å‚¨ç©ºé—´ä¸è¶³ï¼Œæ¸…é™¤ä¸€äº›æ—§çš„ç¼“å­˜
                if (error.name === 'QuotaExceededError') {
                    clearOldCache();
                }
            }
        }

        // æ¸…é™¤ç¿»è¯‘ç¼“å­˜
        function clearTranslationCache() {
            try {
                window.localStorage.removeItem('translationCache');
                translationCache = {};
                console.log('ç¿»è¯‘ç¼“å­˜å·²æ¸…é™¤');
            } catch (error) {
                console.warn('æ¸…é™¤ç¿»è¯‘ç¼“å­˜å¤±è´¥:', error);
            }
        }

        // æ¸…é™¤æ—§çš„ç¼“å­˜æ¡ç›®
        function clearOldCache() {
            const cacheSize = Object.keys(translationCache).length;
            if (cacheSize > 100) {
                // åªä¿ç•™æœ€è¿‘çš„100æ¡ç¼“å­˜
                const entries = Object.entries(translationCache);
                const recentEntries = entries.slice(-100);
                translationCache = Object.fromEntries(recentEntries);
                saveTranslationCache();
                console.log('æ¸…é™¤æ—§ç¼“å­˜ï¼Œä¿ç•™æœ€è¿‘100æ¡è®°å½•');
            }
        }

        // è·å–ç¼“å­˜ç»Ÿè®¡ä¿¡æ¯
        function getCacheStats() {
            const cacheCount = Object.keys(translationCache).length;
            let cacheSize = 0;
            try {
                cacheSize = JSON.stringify(translationCache).length;
            } catch (e) {
                cacheSize = 'unknown';
            }
            return { count: cacheCount, size: cacheSize };
        }

        // æ£€æµ‹æµè§ˆå™¨è¯­è¨€å¹¶è®¾ç½®åˆå§‹è¯­è¨€
        function detectBrowserLanguage() {
            const browserLang = navigator.language || navigator.userLanguage;
            const supportedLangs = ['zh-CN', 'zh-HK', 'en', 'ja', 'ko', 'es', 'fr', 'de', 'ru', 'ar'];
            
            // ç‰¹æ®Šå¤„ç†ç¹ä½“ä¸­æ–‡
            if (browserLang.includes('TW') || browserLang.includes('HK') || browserLang.includes('MO')) {
                return 'zh-TW';
            }
            
            // åŒ¹é…æµè§ˆå™¨è¯­è¨€
            for (let lang of supportedLangs) {
                if (browserLang.startsWith(lang.split('-')[0])) {
                    return lang;
                }
            }
            
            return 'zh-CN'; // é»˜è®¤ç®€ä½“ä¸­æ–‡
        }

        // è·å–å…ƒç´ çš„çº¯æ–‡æœ¬ï¼ˆä¸åŒ…æ‹¬å­å…ƒç´ ï¼‰
        function getDirectText(element) {
            let text = '';
            for (let node of element.childNodes) {
                if (node.nodeType === Node.TEXT_NODE) {
                    text += node.textContent;
                }
            }
            return text.trim();
        }

        // è®¾ç½®å…ƒç´ çš„çº¯æ–‡æœ¬ï¼ˆä¸å½±å“å­å…ƒç´ ï¼‰
        function setDirectText(element, text) {
            for (let node of element.childNodes) {
                if (node.nodeType === Node.TEXT_NODE && node.textContent.trim()) {
                    node.textContent = text;
                    return;
                }
            }
        }

        // åˆ¤æ–­æ˜¯å¦åº”è¯¥ç¿»è¯‘
        function shouldTranslate(text) {
            if (!text || text.length < 2) return false;
            
            // æ’é™¤çš„å†…å®¹
            const excludePatterns = [
                /^[Ã—â—¦]+$/,
                /^\d{4}\.\d{1,2}\.\d{1,2}$/,
                /^[ğŸ¬ğŸ“ºğŸ¥ğŸ“¡ğŸš´â€â™‚ï¸ğŸï¸ğŸ’»âœ¨ğŸ“ğŸ“˜\s]+$/,
                /^(GitHub|Telegram|APTV|TiviMate|YouTube|Twitch|JSON|VPS|LOGO|SSH|DASH|iOS|FHD\/HD|IP|UA|BUG)$/i,
                /https?:\/\//,
                /yang-1989/i
            ];
            
            return !excludePatterns.some(pattern => pattern.test(text));
        }

        // ä¿å­˜åŸå§‹å†…å®¹
        function saveOriginalContent() {
            originalContent.clear();
            
            // éå†æ‰€æœ‰å¯èƒ½åŒ…å«æ–‡æœ¬çš„å…ƒç´ 
            const walker = document.createTreeWalker(
                document.body,
                NodeFilter.SHOW_ELEMENT,
                {
                    acceptNode: function(node) {
                        // æ’é™¤scriptã€styleç­‰æ ‡ç­¾
                        if (['SCRIPT', 'STYLE', 'NOSCRIPT'].includes(node.tagName)) {
                            return NodeFilter.FILTER_REJECT;
                        }
                        return NodeFilter.FILTER_ACCEPT;
                    }
                }
            );

            let node;
            while (node = walker.nextNode()) {
                const directText = getDirectText(node);
                if (directText && shouldTranslate(directText)) {
                    originalContent.set(node, directText);
                }
            }
            
            console.log('ä¿å­˜äº†', originalContent.size, 'ä¸ªæ–‡æœ¬å…ƒç´ ');
        }

        // ä½¿ç”¨Google Translate APIè¿›è¡Œç¿»è¯‘
        async function translateText(text, targetLang) {
            if (targetLang === 'zh-CN') return text;
            
            const cacheKey = `${text}_${targetLang}`;
            
            // å…ˆæ£€æŸ¥ç¼“å­˜
            if (translationCache[cacheKey]) {
                return translationCache[cacheKey];
            }

            try {
                // ä½¿ç”¨å…è´¹çš„ç¿»è¯‘æœåŠ¡
                let targetCode = targetLang.split('-')[0];
                if (targetLang.startsWith('zh-TW') || targetLang.startsWith('zh-HK')) {targetCode = 'zh-TW';}

                const response = await fetch(`https://api.mymemory.translated.net/get?q=${encodeURIComponent(text)}&langpair=zh|${targetCode}`);
                const data = await response.json();
                
                if (data.responseData && data.responseData.translatedText) {
                    const translatedText = data.responseData.translatedText;
                    
                    // ä¿å­˜åˆ°ç¼“å­˜
                    translationCache[cacheKey] = translatedText;
                    
                    // å¼‚æ­¥ä¿å­˜ç¼“å­˜ï¼Œä¸é˜»å¡ç¿»è¯‘è¿‡ç¨‹
                    setTimeout(() => {
                        saveTranslationCache();
                    }, 100);
                    
                    return translatedText;
                }
            } catch (error) {
                console.warn('ç¿»è¯‘å¤±è´¥ï¼Œä½¿ç”¨åŸæ–‡:', error);
            }
            
            return text;
        }

        // ç¿»è¯‘åŠ¨æ€æ–‡æœ¬ï¼ˆç”¨äºå¼¹çª—ç­‰ï¼‰
        async function translateDynamicText(text) {
            if (currentLanguage === 'zh-CN') return text;
            return await translateText(text, currentLanguage);
        }

        // ç¿»è¯‘é¡µé¢å†…å®¹
        async function translatePage(targetLang) {
            if (targetLang === 'zh-CN') {
                restoreOriginalContent();
                return;
            }

            showTranslatingIndicator();
            document.body.classList.add('translating');

            const promises = [];
            let newTranslations = 0;
            
            for (let [element, originalText] of originalContent) {
                const cacheKey = `${originalText}_${targetLang}`;
                
                // å¦‚æœç¼“å­˜ä¸­æœ‰ç¿»è¯‘ï¼Œç›´æ¥ä½¿ç”¨
                if (translationCache[cacheKey]) {
                    setDirectText(element, translationCache[cacheKey]);
                    continue;
                }
                
                // å¦åˆ™æ·»åŠ åˆ°ç¿»è¯‘é˜Ÿåˆ—
                const promise = translateText(originalText, targetLang)
                    .then(translatedText => {
                        if (translatedText && translatedText !== originalText) {
                            setDirectText(element, translatedText);
                            newTranslations++;
                        }
                    })
                    .catch(error => {
                        console.warn('ç¿»è¯‘å¤±è´¥:', originalText, error);
                    });
                promises.push(promise);
            }

            try {
                await Promise.all(promises);
                console.log('ç¿»è¯‘å®Œæˆï¼Œå…±ç¿»è¯‘', promises.length, 'ä¸ªå…ƒç´ ï¼Œæ–°ç¿»è¯‘', newTranslations, 'æ¡');
                
                // å¦‚æœæœ‰æ–°ç¿»è¯‘ï¼Œä¿å­˜ç¼“å­˜
                if (newTranslations > 0) {
                    saveTranslationCache();
                }
                
                const stats = getCacheStats();
                console.log('ç¼“å­˜ç»Ÿè®¡ï¼š', stats.count, 'æ¡è®°å½•ï¼Œå¤§å°çº¦', Math.round(stats.size / 1024), 'KB');
            } catch (error) {
                console.warn('éƒ¨åˆ†ç¿»è¯‘å¤±è´¥:', error);
            }

            hideTranslatingIndicator();
            document.body.classList.remove('translating');
        }

        // æ¢å¤åŸå§‹å†…å®¹
        function restoreOriginalContent() {
            for (let [element, originalText] of originalContent) {
                setDirectText(element, originalText);
            }
            console.log('æ¢å¤åŸå§‹å†…å®¹å®Œæˆ');
        }

        // æ˜¾ç¤ºç¿»è¯‘æŒ‡ç¤ºå™¨
        function showTranslatingIndicator() {
            document.getElementById('translatingIndicator').style.display = 'block';
        }

        // éšè—ç¿»è¯‘æŒ‡ç¤ºå™¨
        function hideTranslatingIndicator() {
            document.getElementById('translatingIndicator').style.display = 'none';
        }

        // è¯­è¨€åˆ‡æ¢å‡½æ•°
        async function changeLanguage(lang) {
            if (lang === currentLanguage) return;
            
            currentLanguage = lang;
            window.localStorage.setItem('selectedLanguage', lang);
            document.documentElement.lang = lang;
            
            await translatePage(lang);
        }

        // åˆå§‹åŒ–
        window.onload = function() {
            // é¦–å…ˆåŠ è½½ç¿»è¯‘ç¼“å­˜
            loadTranslationCache();
            
            // å»¶è¿Ÿä¿å­˜åŸå§‹å†…å®¹ï¼Œç¡®ä¿æ¨¡æ€æ¡†å†…å®¹å·²æ¸²æŸ“
            setTimeout(() => {
                saveOriginalContent();
                
                // è·å–ä¿å­˜çš„è¯­è¨€åå¥½æˆ–æ£€æµ‹æµè§ˆå™¨è¯­è¨€
                const savedLang = window.localStorage.getItem('selectedLanguage');
                const initialLang = savedLang || detectBrowserLanguage();
                
                document.getElementById('languageSelect').value = initialLang;
                if (initialLang !== 'zh-CN') {
                    changeLanguage(initialLang);
                }
            }, 100);
            
            showUpdateNotice();
        };

        // åŸæœ‰çš„åŠŸèƒ½å‡½æ•°ä¿æŒä¸å˜
        function showUpdateNotice() {
            const modal = document.getElementById('updateModal');
            modal.style.display = 'block';
        }

        function closeUpdateNotice() {
            const modal = document.getElementById('updateModal');
            modal.style.display = 'none';
        }

        async function copySubscriptionLink(link) {
            try {
                await navigator.clipboard.writeText(link);
                const message = await translateDynamicText("è®¢é˜…é“¾æ¥å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼Œè¯·åœ¨ æ’­æ”¾å™¨ ä¸­ä½¿ç”¨ã€‚");
                alert(message);
            } catch (err) {
                console.error('æ— æ³•å¤åˆ¶æ–‡æœ¬: ', err);
                const errorMsg = await translateDynamicText("å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶é“¾æ¥ã€‚");
                alert(errorMsg);
            }
        }

        async function copySubscriptiontext(text) {
            try {
                await navigator.clipboard.writeText(text);
                const message = await translateDynamicText("å·²å¤åˆ¶è„šæœ¬å‘½ä»¤åˆ°å‰ªè´´æ¿ï¼è¯·åœ¨ SSH ç»ˆç«¯ä¸­ç²˜è´´ä½¿ç”¨ã€‚");
                alert(message);
            } catch (err) {
                console.error('å¤åˆ¶å¤±è´¥: ', err);
                const errorMsg = await translateDynamicText("å¤åˆ¶å¤±è´¥ï¼š") + err;
                alert(errorMsg);
            }
        }

        async function copyMytvLink() {
            const message = await translateDynamicText("ä½ éœ€è¦ä¸€å€‹æ”¯æ´ DASH å”è­°çš„æ’­æ”¾å™¨ï¼Œç›®å‰ iOS ä¸æ”¯æŒæ­¤åª’é«”ã€‚");
            
            if (confirm(message)) {
                copySubscriptionLink("https://tv.iill.top/m3u/MyTV");
            } else {
                const info = await translateDynamicText("æ”¯æŒ DASH å”è­°çš„æ’­æ”¾å™¨ï¼Œå¦‚å½±è¦–TVã€å¤©å…‰äº‘å½±ã€TiviMate å’Œ OTT ç­‰ã€‚");
                alert(info);
            }
        }

        async function copyYsLink() {
            const message = await translateDynamicText("å½±è§† Json ç›´æ’­è®¢é˜…åœ°å€");
            
            if (confirm(message)) {
                copySubscriptionLink("https://tv.iill.top/json/Gather");
            }
        }


        async function copySportLink() {
            const message = await translateDynamicText("è¯·ä»”ç»†é˜…è¯» ç½®é¡¶æç¤º è¿›è¡Œé£Ÿç”¨ï¼ˆæ’­æ”¾å™¨å…¼å®¹æ€§ä¸ä½³ï¼‰...");
            
            if (confirm(message)) {
                copySubscriptionLink("https://tv.iill.top/m3u/Sport");
            }
        }

        async function copyShellLink() {
            const message = await translateDynamicText("è¿™æ˜¯ä¸€ä¸ªä¸ IPTV ç›¸å…³é¡¹ç›®çš„æ­å»ºè„šæœ¬ï¼Œå†…å«å°å·¥å…·ç­‰ï¼ˆè½¯è·¯ç”±å…¼å®¹æ€§ä¸ä½³ï¼‰ã€‚");
            
            if (confirm(message)) {
                copySubscriptiontext("bash <(curl -sL https://yang-1989.eu.org/NoobIPTV.sh)");
            }
        }
    </script>
</body>
</html>